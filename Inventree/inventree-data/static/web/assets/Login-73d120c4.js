import{aq as C,j as e,G as u,$ as P,dL as q,C as O,ag as D,dM as G,h as g,o as I,dN as M,dO as Z,dP as W,dQ as Y,dR as X,dS as K,dT as $,dU as Q,dV as J,dW as ee,dX as se,dY as ie,r as w,D as S,i as t,S as T,aj as b,dZ as F,A as L,L as te,n as f,I as k,bG as ne,B as oe,s as re,d_ as ae,E as de,dl as R,T as le,aK as ce,g as xe,ap as ue}from"./vendor-580d7f6a.js";import{T as r}from"./BaseContext-71d55e61.js";import{f as _,g as y,i as H,A as N,t as me,d as je,v as ge,u as U,w as pe,x as he}from"./index-539d0685.js";import{L as fe,C as be}from"./LanguageSelect-936cbb64.js";import{u as E}from"./use-form-08e322e0.js";import{u as A,e as _e}from"./DesktopAppView-f36ad07f.js";import{E as B}from"./EditButton-578ed85a.js";function Ie(){const[i,a]=C();return e.jsxs(u,{position:"center",style:{border:i===!0?"1px dashed ":"",margin:i===!0?2:12,padding:i===!0?8:0},children:[e.jsx(P,{onClick:()=>a.toggle(),size:"lg",children:e.jsx(q,{})}),i&&e.jsx(u,{children:e.jsx(fe,{})})]})}function ve({hostname:i,toggleHostEdit:a}){const[s]=_(d=>[d.server]);return e.jsx(O,{mx:"md",children:e.jsxs(u,{children:[e.jsx(be,{}),e.jsx(Ie,{}),window.INVENTREE_SETTINGS.show_server_selector&&e.jsx(D,{label:i,children:e.jsx(G,{onClick:a})}),e.jsxs(g,{c:"dimmed",children:[s.version," | ",s.apiVersion]})]})})}const we={google:e.jsx(Z,{}),github:e.jsx(W,{}),facebook:e.jsx(Y,{}),discord:e.jsx(X,{}),twitter:e.jsx(K,{}),bitbucket:e.jsx($,{}),flickr:e.jsx(Q,{}),gitlab:e.jsx(J,{}),reddit:e.jsx(ee,{}),twitch:e.jsx(se,{}),microsoft:e.jsx(ie,{})};function V({provider:i}){function a(){y.put(H(N.ui_preference),{preferred_method:"pui"},{headers:{Authorization:""}}).then(()=>{window.location.href=i.login})}return e.jsxs(I,{leftIcon:Se(i),radius:"xl",component:"a",onClick:a,children:[i.display_name," "]})}function Se(i){return we[i.id]||e.jsx(M,{})}function Le(){const i=E({initialValues:{username:"",password:""}}),a=E({initialValues:{email:""}}),[s,d]=C(!0),[o]=_(c=>[c.auth_settings]),l=A(),[m,n]=w.useState(!1);function j(){n(!0),s===!0?me(i.values.username,i.values.password).then(()=>{n(!1),je.getState().hasToken()?(f.show({title:t._({id:"6cPKtu"}),message:t._({id:"rxWA39"}),color:"green",icon:e.jsx(k,{size:"1rem"})}),l("/home")):f.show({title:t._({id:"4GKuCs"}),message:t._({id:"tnaYa/"}),color:"red"})}):ge(a.values.email).then(c=>{n(!1),(c==null?void 0:c.status)==="ok"?f.show({title:t._({id:"XAIcYu"}),message:t._({id:"R2JMfc"}),color:"green",icon:e.jsx(k,{size:"1rem"}),autoClose:!1}):f.show({title:t._({id:"ccnxuA"}),message:t._({id:"tnaYa/"}),color:"red"})})}return e.jsxs(e.Fragment,{children:[(o==null?void 0:o.sso_enabled)===!0?e.jsxs(e.Fragment,{children:[e.jsx(u,{grow:!0,mb:"md",mt:"md",children:o.providers.map(c=>e.jsx(V,{provider:c},c.id))}),e.jsx(S,{label:t._({id:"zTZjMy"}),labelPosition:"center",my:"lg"})]}):null,e.jsxs("form",{onSubmit:i.onSubmit(()=>{}),children:[s?e.jsxs(T,{spacing:0,children:[e.jsx(b,{required:!0,label:t._({id:"7sNhEz"}),placeholder:t._({id:"k1RkIL"}),...i.getInputProps("username")}),e.jsx(F,{required:!0,label:t._({id:"8ZsakT"}),placeholder:t._({id:"9TO8nT"}),...i.getInputProps("password")}),(o==null?void 0:o.password_forgotten_enabled)===!0&&e.jsx(u,{position:"apart",mt:"0",children:e.jsx(L,{component:"button",type:"button",color:"dimmed",size:"xs",onClick:()=>l("/reset-password"),children:e.jsx(r,{id:"RfwZxd"})})})]}):e.jsx(T,{children:e.jsx(b,{required:!0,label:t._({id:"O3oNi5"}),description:t._({id:"Wr5sDQ"}),placeholder:"email@example.org",...a.getInputProps("email")})}),e.jsxs(u,{position:"apart",mt:"xl",children:[e.jsx(L,{component:"button",type:"button",color:"dimmed",size:"xs",onClick:()=>d.toggle(),children:s?e.jsx(r,{id:"7ZOmjI"}):e.jsx(r,{id:"vZk5Sm"})}),e.jsx(I,{type:"submit",disabled:m,onClick:j,children:m?e.jsx(te,{size:"sm"}):e.jsx(e.Fragment,{children:s?e.jsx(r,{id:"ADVQ46"}):e.jsx(r,{id:"i/TzEU"})})})]})]})]})}function ke(){const i=E({initialValues:{username:"",email:"",password1:"",password2:""}}),a=A(),[s]=_(n=>[n.auth_settings]),[d,o]=w.useState(!1);function l(){o(!0),y.post(H(N.user_register),i.values,{headers:{Authorization:""}}).then(n=>{(n==null?void 0:n.status)===204&&(o(!1),f.show({title:t._({id:"EoCs7m"}),message:t._({id:"n2c6Ul"}),color:"green",icon:e.jsx(k,{size:"1rem"})}),a("/home"))}).catch(n=>{var j,c;if(n.response.status===400){o(!1);for(const[h,v]of Object.entries(n.response.data))i.setFieldError(h,v);let x="";(c=(j=n.response)==null?void 0:j.data)!=null&&c.non_field_errors&&(x=n.response.data.non_field_errors),f.show({title:t._({id:"ccnxuA"}),message:t._({id:"tnaYa/"})+x,color:"red",autoClose:3e4})}})}const m=(s==null?void 0:s.registration_enabled)&&(s==null?void 0:s.sso_registration);return e.jsxs(e.Fragment,{children:[(s==null?void 0:s.registration_enabled)&&e.jsxs("form",{onSubmit:i.onSubmit(()=>{}),children:[e.jsxs(T,{spacing:0,children:[e.jsx(b,{required:!0,label:t._({id:"7sNhEz"}),placeholder:t._({id:"k1RkIL"}),...i.getInputProps("username")}),e.jsx(b,{required:!0,label:t._({id:"O3oNi5"}),description:t._({id:"kXXdWU"}),placeholder:"email@example.org",...i.getInputProps("email")}),e.jsx(F,{required:!0,label:t._({id:"8ZsakT"}),placeholder:t._({id:"9TO8nT"}),...i.getInputProps("password1")}),e.jsx(F,{required:!0,label:t._({id:"NK5XEe"}),placeholder:t._({id:"R1OtIL"}),...i.getInputProps("password2")})]}),e.jsx(u,{position:"apart",mt:"xl",children:e.jsx(I,{type:"submit",disabled:d,onClick:l,fullWidth:!0,children:e.jsx(r,{id:"fgLNSM"})})})]}),m&&e.jsx(S,{label:t._({id:"IES56a"}),labelPosition:"center",my:"lg"}),(s==null?void 0:s.sso_registration)===!0&&e.jsx(u,{grow:!0,mb:"md",mt:"md",children:s.providers.map(n=>e.jsx(V,{provider:n},n.id))})]})}function Ee({loginMode:i,setMode:a}){const[s]=_(o=>[o.auth_settings]);return((s==null?void 0:s.registration_enabled)||(s==null?void 0:s.sso_registration)||!1)===!1?null:e.jsx(g,{ta:"center",size:"xs",mt:"md",children:i?e.jsxs(e.Fragment,{children:[e.jsx(r,{id:"ln9/n9"})," ",e.jsx(L,{component:"button",type:"button",color:"dimmed",size:"xs",onClick:()=>a.close(),children:e.jsx(r,{id:"fgLNSM"})})]}):e.jsx(L,{component:"button",type:"button",color:"dimmed",size:"xs",onClick:()=>a.open(),children:e.jsx(r,{id:"jZUk0D"})})})}function Te({data:i,saveOptions:a}){const s=E({initialValues:i});function d(l){const m=s.values;delete m[l],s.setValues(m)}const o=Object.entries(s.values).map(([l])=>e.jsx(u,{mt:"xs",children:s.values[l]!==void 0&&e.jsxs(e.Fragment,{children:[e.jsx(b,{placeholder:t._({id:"Ai2U7L"}),withAsterisk:!0,sx:{flex:1},...s.getInputProps(`${l}.host`)}),e.jsx(b,{placeholder:t._({id:"6YtxFj"}),withAsterisk:!0,sx:{flex:1},...s.getInputProps(`${l}.name`)}),e.jsx(P,{color:"red",onClick:()=>{d(l)},children:e.jsx(ne,{})})]})},l));return e.jsx("form",{onSubmit:s.onSubmit(a),children:e.jsxs(oe,{sx:{maxWidth:500},mx:"auto",children:[o.length>0?e.jsxs(u,{mb:"xs",children:[e.jsx(g,{weight:500,size:"sm",sx:{flex:1},children:e.jsx(r,{id:"Ai2U7L"})}),e.jsx(g,{weight:500,size:"sm",sx:{flex:1},children:e.jsx(r,{id:"6YtxFj"})})]}):e.jsx(g,{color:"dimmed",align:"center",children:e.jsx(r,{id:"yWMzcH"})}),o,e.jsxs(u,{mt:"md",children:[e.jsxs(I,{onClick:()=>s.setFieldValue(`${re()}`,{name:"",host:""}),children:[e.jsx(ae,{}),e.jsx(r,{id:"UYWLpE"})]}),e.jsx(de,{sx:{flex:1}}),e.jsx(I,{type:"submit",children:e.jsx(r,{id:"tfDRzk"})})]})]})})}function Fe({hostKey:i,ChangeHost:a,setHostEdit:s}){const[d,o]=R([!1,!0]),[l,m,n]=U(x=>[x.setHost,x.setHostList,x.hostList]),j=Object.keys(n).map(x=>{var h;return{value:x,label:(h=n[x])==null?void 0:h.name}});function c(x){m(x),x[i]===void 0&&l("",""),o()}return e.jsxs(e.Fragment,{children:[e.jsx(le,{order:3,children:e.jsx(r,{id:"GG8+B2"})}),e.jsxs(u,{children:[e.jsxs(u,{children:[e.jsx(ce,{value:i,onChange:a,data:j,disabled:d}),e.jsx(B,{setEditing:o,editing:d,disabled:d})]}),e.jsx(B,{setEditing:s,editing:!0,disabled:d,saveIcon:e.jsx(k,{})})]}),d?e.jsxs(e.Fragment,{children:[e.jsx(S,{my:"sm"}),e.jsx(g,{children:e.jsx(r,{id:"uqEJlE"})}),e.jsx(Te,{data:n,saveOptions:c})]}):e.jsxs(e.Fragment,{children:[e.jsx(S,{my:"sm"}),e.jsx(Ce,{hostList:n,hostKey:i})]})]})}function Ce({hostList:i,hostKey:a}){var d;const[s]=_(o=>[o.server]);return e.jsxs(g,{children:[(d=i[a])==null?void 0:d.host,e.jsx("br",{}),e.jsx(r,{id:"GUtCZC",values:{0:s.version}}),e.jsx("br",{}),e.jsx(r,{id:"4/F1y3",values:{0:s.apiVersion}}),e.jsx("br",{}),e.jsx(r,{id:"UVRlfm",values:{0:s.instance}}),e.jsx("br",{}),e.jsx(r,{id:"ed0N/H",values:{0:s.worker_pending_tasks,1:s.plugins_enabled?` (${s.active_plugins.length})`:null},components:{0:e.jsx(g,{span:!0,c:s.worker_running?"green":"red"}),1:e.jsx(g,{span:!0,c:s.plugins_enabled?"green":"red"})}})]})}function He(){var v;const[i,a,s]=U(p=>[p.hostKey,p.setHost,p.hostList]),[d,o]=_(p=>[p.server,p.fetchServerApiState]),l=s[i]===void 0?t._({id:"bX1aQ5"}):(v=s[i])==null?void 0:v.name,[m,n]=R([!1,!0]),[j,c]=C(!0),x=A();function h(p){var z;a((z=s[p])==null?void 0:z.host,p),he(),o()}return w.useEffect(()=>{i===""&&h(_e),pe(x,void 0,!0)},[]),w.useEffect(()=>{d.server===null&&o()},[d]),e.jsx(O,{mih:"100vh",children:e.jsx(xe,{w:"md",miw:400,children:m?e.jsx(Fe,{hostKey:i,ChangeHost:h,setHostEdit:n}):e.jsxs(e.Fragment,{children:[e.jsxs(ue,{radius:"md",p:"xl",withBorder:!0,children:[e.jsx(g,{size:"lg",weight:500,children:j?e.jsx(r,{id:"BL4vL0"}):e.jsx(r,{id:"qJ5FUT"})}),j?e.jsx(Le,{}):e.jsx(ke,{}),e.jsx(Ee,{loginMode:j,setMode:c})]}),e.jsx(ve,{hostname:l,toggleHostEdit:n})]})})})}export{He as default};
