import{r as o,i as s,j as e,G as I,h as p,af as D,cW as S,S as r,n as u,dj as v,am as w,ay as V,O as J,e5 as z,m as B,B as H,T as k,bh as Q,aJ as A,ag as T,e6 as N}from"./vendor-580d7f6a.js";import{m as U,T as j}from"./BaseContext-71d55e61.js";import{a as X,f as q,i as P,A as c,g as K}from"./index-539d0685.js";import{u as $,A as W,I as ee}from"./InvenTreeTable-7dffc519.js";import{A as se,E as ie}from"./ActionDropdown-0b7f88be.js";import{I as n}from"./InfoItem-0edf1cea.js";import{S as te}from"./StylishText-5ee5b946.js";import{D as ae}from"./DetailDrawer-7bb74add.js";import{P as le}from"./SettingList-5fd10bc0.js";import{a as ne}from"./ApiForm-173d0ec5.js";import{a as oe,u as re,b as ce}from"./UseForm-5e9a21d6.js";import{u as de}from"./UseInstance-05463349.js";import{u as ue}from"./DesktopAppView-f36ad07f.js";import"./notifications-b554622d.js";import"./YesNoButton-cd4c504e.js";import"./Instance-4f17d9b0.js";function pe({id:a,refreshTable:h}){var g,b;const{instance:i,refreshInstance:d,instanceQuery:{isFetching:_,error:m}}=de({endpoint:c.plugin_list,pk:a,throwError:!0}),f=o.useCallback(()=>{h(),d()},[h,d]);return _?e.jsx(B,{visible:!0}):m?e.jsx(p,{children:((g=m==null?void 0:m.response)==null?void 0:g.status)===404?e.jsx(j,{id:"OC2EKF",values:{id:a}}):e.jsx(j,{id:"1eDLl4"})}):e.jsxs(r,{spacing:"xs",children:[e.jsxs(I,{position:"apart",children:[e.jsx(H,{}),e.jsxs(I,{spacing:"xs",children:[i&&Y(i),e.jsx(k,{order:4,children:((b=i==null?void 0:i.meta)==null?void 0:b.human_name)??(i==null?void 0:i.name)??"-"})]}),e.jsx(se,{tooltip:s._({id:"etUvlY"}),icon:e.jsx(Q,{}),actions:[ie({tooltip:s._({id:"CL5Gfb"}),onClick:()=>{ne({title:s._({id:"CL5Gfb"}),url:c.plugin_list,pk:a,fields:{active:{}},onClose:f})}}),{name:s._({id:"HpK/8d"}),tooltip:s._({id:"HpK/8d"}),icon:e.jsx(w,{}),onClick:d}]})]}),e.jsx(B,{visible:_,overlayOpacity:0}),e.jsx(A,{withBorder:!0,children:e.jsxs(r,{spacing:"md",children:[e.jsx(k,{order:4,children:e.jsx(j,{id:"t4Dg7a"})}),e.jsxs(r,{pos:"relative",spacing:"xs",children:[e.jsx(n,{type:"text",name:s._({id:"6YtxFj"}),value:i==null?void 0:i.name}),e.jsx(n,{type:"text",name:s._({id:"Nu4oKW"}),value:i==null?void 0:i.meta.description}),e.jsx(n,{type:"text",name:s._({id:"VbeIOx"}),value:i==null?void 0:i.meta.author}),e.jsx(n,{type:"text",name:s._({id:"mYGY3B"}),value:i==null?void 0:i.meta.pub_date}),e.jsx(n,{type:"text",name:s._({id:"eE0JZ4"}),value:i==null?void 0:i.meta.version}),e.jsx(n,{type:"boolean",name:s._({id:"F6pfE9"}),value:i==null?void 0:i.active})]})]})}),e.jsx(A,{withBorder:!0,children:e.jsxs(r,{spacing:"md",children:[e.jsx(k,{order:4,children:e.jsx(j,{id:"sxxj4o"})}),e.jsxs(r,{pos:"relative",spacing:"xs",children:[(i==null?void 0:i.is_package)&&e.jsx(n,{type:"text",name:s._({id:"/L+cAM"}),value:i==null?void 0:i.package_name}),e.jsx(n,{type:"text",name:s._({id:"AJd5vK"}),value:i==null?void 0:i.meta.package_path}),e.jsx(n,{type:"boolean",name:s._({id:"++LBSt"}),value:i==null?void 0:i.is_builtin}),e.jsx(n,{type:"boolean",name:s._({id:"mGYa19"}),value:i==null?void 0:i.is_package})]})]})}),i&&i.active&&e.jsx(A,{withBorder:!0,children:e.jsxs(r,{spacing:"md",children:[e.jsx(k,{order:4,children:e.jsx(j,{id:"xWsR91"})}),e.jsx(le,{pluginPk:a})]})})]})}function Y(a){return a.is_installed?a.active?e.jsx(T,{label:s._({id:"QqLLp2"}),children:e.jsx(S,{color:"green"})}):e.jsx(T,{label:s._({id:"s99Mc1"}),children:e.jsx(v,{color:"red"})}):e.jsx(T,{label:s._({id:"LtEW/l"}),children:e.jsx(N,{})})}function we(){const a=$("plugin"),h=ue(),i=X(),[d,_]=q(t=>[t.server.plugins_enabled,t.server.plugins_install_disabled]),m=o.useMemo(()=>[{accessor:"name",title:s._({id:"fOuPPd"}),sortable:!0,render:function(t){return e.jsxs(I,{position:"left",children:[e.jsx(Y,{...t}),e.jsx(p,{children:t.name})]})}},{accessor:"meta.description",title:s._({id:"Nu4oKW"}),sortable:!1,render:function(t){return t.active?t.meta.description:e.jsx(p,{italic:!0,children:s._({id:"9YdyZU"})})}},{accessor:"meta.version",title:s._({id:"eE0JZ4"}),sortable:!1},{accessor:"meta.author",title:"Author",sortable:!1}],[]),f=o.useCallback((t,l,x)=>{U.openConfirmModal({title:e.jsx(te,{children:x?s._({id:"2RHgaV"}):s._({id:"KyWCx1"})}),children:e.jsx(D,{color:"green",icon:e.jsx(S,{}),title:x?s._({id:"fLe7w+"}):s._({id:"oBCe/M"}),children:e.jsxs(r,{spacing:"xs",children:[e.jsxs(p,{children:[x?s._({id:"LZ82cI"}):s._({id:"DSZP3u"}),":"]}),e.jsx(p,{size:"lg",italic:!0,children:l})]})}),labels:{cancel:s._({id:"dEgA5A"}),confirm:s._({id:"7VpPHA"})},onConfirm:()=>{let R=P(c.plugin_activate,t);const y="plugin-activate";u.show({id:y,message:x?s._({id:"zKwhqX"}):s._({id:"31OZWt"}),loading:!0}),K.patch(R,{active:x},{timeout:30*1e3}).then(()=>{a.refreshTable(),u.hide(y),u.show({title:s._({id:"lOONZM"}),message:x?s._({id:"VAuM5b"}):s._({id:"ysKQPq"}),color:"green"})}).catch(me=>{u.hide(y),u.show({title:s._({id:"SlfejT"}),message:s._({id:"ycupYY"}),color:"red"})})}})},[]),g=o.useCallback(t=>{let l=[];return!t.is_builtin&&t.is_installed&&(t.active?l.push({title:s._({id:"5y3O+A"}),color:"red",icon:e.jsx(v,{}),onClick:()=>{f(t.pk,t.name,!1)}}):l.push({title:s._({id:"FQBaXG"}),color:"green",icon:e.jsx(S,{}),onClick:()=>{f(t.pk,t.name,!0)}})),t.active&&t.is_package&&t.package_name&&l.push({title:s._({id:"EkH9pt"}),color:"blue",icon:e.jsx(w,{}),onClick:()=>{E(t.package_name),C.open()}}),!t.active&&t.is_installed&&t.is_package&&t.package_name&&l.push({title:s._({id:"fo0VXg"}),color:"red",icon:e.jsx(v,{}),onClick:()=>{F(t.pk),O.open()},disabled:_||!1}),t.is_installed||l.push({title:s._({id:"cnGeoo"}),color:"red",icon:e.jsx(v,{}),onClick:()=>{F(t.pk),L.open()}}),l},[i,d]),[b,E]=o.useState(""),C=oe({title:s._({id:"R7k68Z"}),url:c.plugin_install,timeout:3e4,fields:{packagename:{},url:{},version:{},confirm:{}},initialData:{packagename:b},closeOnClickOutside:!1,submitText:s._({id:"TKQ7K+"}),successMessage:void 0,onFormSuccess:t=>{u.show({title:s._({id:"MiYlP5"}),message:t.result,autoClose:3e4,color:"green"}),a.refreshTable()}}),[M,F]=o.useState(-1),O=re({title:s._({id:"mXzRzO"}),url:c.plugin_uninstall,pk:M,fetchInitialData:!1,timeout:3e4,fields:{delete_config:{}},preFormContent:e.jsx(D,{color:"red",icon:e.jsx(V,{}),title:s._({id:"6onEou"}),children:e.jsxs(r,{spacing:"xs",children:[e.jsx(p,{children:s._({id:"nh4MTY"})}),e.jsx(p,{children:s._({id:"2xOCJW"})})]})}),onFormSuccess:t=>{u.show({title:s._({id:"MAZU/W"}),message:t.result,autoClose:3e4,color:"green"}),a.refreshTable()}}),L=ce({url:c.plugin_list,pk:M,title:s._({id:"nud26y"}),onFormSuccess:a.refreshTable,preFormWarning:s._({id:"vb5uIh"})}),Z=o.useCallback(()=>{K.post(P(c.plugin_reload),{full_reload:!0,force_reload:!0,collect_plugins:!0}).then(()=>{J({title:s._({id:"Bs76+T"}),message:s._({id:"js1VzJ"}),color:"green"}),a.refreshTable()})},[]),G=o.useMemo(()=>{var l;let t=[];return(l=i.user)!=null&&l.is_superuser&&d&&(t.push(e.jsx(W,{color:"green",icon:e.jsx(w,{}),tooltip:s._({id:"2VWTDu"}),onClick:Z})),t.push(e.jsx(W,{color:"green",icon:e.jsx(z,{}),tooltip:s._({id:"0O/OZv"}),onClick:()=>{E(""),C.open()},disabled:_||!1}))),t},[i,d]);return e.jsxs(e.Fragment,{children:[C.modal,O.modal,L.modal,e.jsx(ae,{title:s._({id:"jgl9ip"}),size:"xl",renderContent:t=>t?e.jsx(pe,{id:t,refreshTable:a.refreshTable}):!1}),e.jsx(ee,{url:P(c.plugin_list),tableState:a,columns:m,props:{enableDownload:!1,rowActions:g,onRowClick:t=>h(`${t.pk}/`),tableActions:G,tableFilters:[{name:"active",label:s._({id:"F6pfE9"}),type:"boolean"},{name:"builtin",label:s._({id:"++LBSt"}),type:"boolean"},{name:"sample",label:s._({id:"LcJmOR"}),type:"boolean"},{name:"installed",label:s._({id:"eQkgKV"}),type:"boolean"}]}})]})}export{pe as PluginDrawer,we as default};
