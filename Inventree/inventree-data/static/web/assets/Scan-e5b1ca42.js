import{j as e,ay as ne,G as m,T as te,d7 as se,N as ie,J as X,r as f,i as c,o as K,d8 as ae,d9 as le,E as Z,b7 as oe,da as J,S as V,aK as $,h as y,$ as k,bG as U,ak as ce,bS as re,c0 as ue,ao as de,db as he,an as Y,U as xe,z as je,_ as fe,aj as pe,dc as me,cN as ge,K as be,O as N,P as O,dd as ke,de as Se,y as Ie,g as we,s as G}from"./vendor-580d7f6a.js";import{T as u,H as Q}from"./BaseContext-71d55e61.js";import{g as W,i as q,A as ye,I as _e,M as w}from"./index-539d0685.js";import{D as Ce}from"./DocTooltip-119b7cc3.js";import{S as De}from"./StylishText-5ee5b946.js";import{R as Fe}from"./Instance-4f17d9b0.js";import{M as Ee}from"./ModelType-07300e1e.js";import{n as Me}from"./notifications-b554622d.js";function ee({size:n=18,text:i,detail:o,link:a}){return e.jsx(Ce,{text:i,detail:o,link:a,children:e.jsx(ne,{size:n})})}function P({children:n,variant:i,order:o,size:a,text:j,detail:h}){return e.jsxs(m,{children:[e.jsx(te,{variant:i,order:o,size:a,children:n}),j&&e.jsx(ee,{text:j,detail:h})]})}function Te(n){return n!=null&&n.part?[w.part,n==null?void 0:n.part.pk]:n!=null&&n.stockitem?[w.stockitem,n==null?void 0:n.stockitem.pk]:n!=null&&n.stocklocation?[w.stocklocation,n==null?void 0:n.stocklocation.pk]:n!=null&&n.supplierpart?[w.supplierpart,n==null?void 0:n.supplierpart.pk]:n!=null&&n.purchaseorder?[w.purchaseorder,n==null?void 0:n.purchaseorder.pk]:n!=null&&n.salesorder?[w.salesorder,n==null?void 0:n.salesorder.pk]:n!=null&&n.build?[w.build,n==null?void 0:n.build.pk]:[void 0,void 0]}function Xe(){var b;const{toggle:n,fullscreen:i}=se(),[o,a]=ie([]),[j,h]=X({key:"scan-history",defaultValue:[]}),[s,r]=f.useState([]),[S,g]=X({key:"input-selection",defaultValue:null});function E(){const l=I(s[0]);l&&C(l==null?void 0:l.ref,l==null?void 0:l.id)}const M=s.length===1&&((b=I(s[0]))==null?void 0:b.link)!=null;function T(){const l=I(s[0]);l&&M&&window.open(l.link,"_blank")}function _(){a.setState([]),h([]),r([])}function A(){a.setState(o.filter(l=>!s.includes(l.id))),r([])}function I(l){if(s.length===0)return;const d=o.find(p=>p.id===l);if((d==null?void 0:d.ref)!==void 0)return d}function C(l,d){W.post(q(ye.barcode),{barcode:l}).then(p=>{var F;if(!d)return;const x=I(s[0]);if(!x)return;x.link=(F=p.data)==null?void 0:F.url;const D=Te(p.data);if(x.model=D[0],x.pk=D[1],x.model&&x.pk){let v=Ee[x.model];if(v&&v.api_endpoint){let L=q(v.api_endpoint,x.pk);W.get(L).then(z=>{x.instance=z.data}).catch(z=>{console.error("error while fetching instance data at",L),console.info(z)})}}a.setState(o)}).catch(p=>{var x,D,F;((x=p.response)==null?void 0:x.status)===400&&((F=(D=p.response)==null?void 0:D.data)==null?void 0:F.plugin)==="None"||console.log("error while running barcode",p)})}function H(l){for(const d of l)a.append(d),C(d.ref,d.id);r(l.map(d=>d.id))}f.useEffect(()=>{o.length!==0&&h(o)},[o]),o.length===0&&j.length!=0&&a.setState(j);const R=[{value:"manually",label:c._({id:"pS7MTY"})},{value:"imageBarcode",label:c._({id:"29Om2/"})}],B=function(){switch(S){case"manually":return e.jsx(He,{action:H});case"imageBarcode":return e.jsx(Re,{action:H});default:return e.jsx(y,{children:"No input selected"})}}(),t=()=>{const l=[...new Set(s.map(d=>{var p;return(p=o.find(x=>x.id===d))==null?void 0:p.model}).filter(d=>d!=null))];return l.length===0?e.jsxs(m,{spacing:0,children:[e.jsx(ue,{color:"orange"}),e.jsx(u,{id:"dQStih"})]}):l.length>1?e.jsxs(m,{spacing:0,children:[e.jsx(de,{color:"orange"}),e.jsx(u,{id:"Oik3bo"})]}):e.jsxs(e.Fragment,{children:[e.jsx(y,{fz:"sm",c:"dimmed",children:e.jsx(u,{id:"RlLl3G",values:{0:l[0]}})}),e.jsx(m,{children:e.jsx(k,{onClick:Me,title:c._({id:"wBMjJ2"}),children:e.jsx(he,{})})})]})};return e.jsxs(e.Fragment,{children:[e.jsxs(m,{position:"apart",children:[e.jsxs(m,{position:"left",children:[e.jsx(De,{children:e.jsx(u,{id:"T2Wq4D"})}),e.jsx(ee,{text:c._({id:"cXiEKg"})})]}),e.jsx(K,{onClick:n,size:"sm",variant:"subtle",children:i?e.jsx(ae,{}):e.jsx(le,{})})]}),e.jsx(Z,{h:"md"}),e.jsxs(oe,{maw:"100%",children:[e.jsx(J,{span:4,children:e.jsxs(V,{children:[e.jsxs(V,{spacing:"xs",children:[e.jsxs(m,{position:"apart",children:[e.jsx(P,{order:3,text:c._({id:"qBZttg"}),children:e.jsx(u,{id:"XU5AOg"})}),e.jsx($,{value:S,onChange:g,data:R,searchable:!0,placeholder:c._({id:"kY/87m"}),nothingFound:c._({id:"ow3fug"})})]}),B]}),e.jsxs(V,{spacing:0,children:[e.jsx(P,{order:3,text:c._({id:"66J/c0"}),children:e.jsx(u,{id:"bwRvnp"})}),s.length===0?e.jsx(y,{children:e.jsx(u,{id:"bX1aQ5"})}):e.jsxs(e.Fragment,{children:[e.jsx(y,{children:e.jsx(u,{id:"sQhVFe",values:{0:s.length}})}),e.jsx(y,{fz:"sm",c:"dimmed",children:e.jsx(u,{id:"U+sonC"})}),e.jsxs(m,{children:[e.jsx(k,{color:"red",onClick:A,title:c._({id:"cnGeoo"}),children:e.jsx(U,{})}),e.jsx(k,{onClick:E,disabled:s.length>1,title:c._({id:"H8H7u6"}),children:e.jsx(ce,{})}),e.jsx(k,{onClick:T,disabled:!M,title:c._({id:"sliuzR"}),children:e.jsx(re,{})})]}),e.jsx(t,{})]})]})]})}),e.jsxs(J,{span:8,children:[e.jsxs(m,{position:"apart",children:[e.jsx(P,{order:3,text:c._({id:"mM7dgZ"}),detail:c._({id:"s9lCxX"}),children:e.jsx(u,{id:"0caMy7"})}),e.jsx(k,{color:"red",onClick:_,children:e.jsx(U,{})})]}),e.jsx(Ae,{data:o,selection:s,setSelection:r})]})]})]})}function Ae({data:n,selection:i,setSelection:o}){const a=s=>o(r=>r.includes(s)?r.filter(S=>S!==s):[...r,s]),j=()=>o(s=>s.length===n.length?[]:n.map(r=>r.id)),h=n.map(s=>{var r;return i.includes(s.id),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx(Y,{checked:i.includes(s.id),onChange:()=>a(s.id),transitionDuration:0})}),e.jsx("td",{children:s.pk&&s.model&&s.instance?e.jsx(Fe,{model:s.model,instance:s.instance}):s.ref}),e.jsx("td",{children:s.model}),e.jsx("td",{children:s.source}),e.jsx("td",{children:(r=s.timestamp)==null?void 0:r.toString()})]},s.id)});return n.length===0?e.jsx(y,{children:e.jsx(u,{id:"nB43gC"})}):e.jsx(xe,{children:e.jsxs(je,{miw:800,verticalSpacing:"sm",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:{width:fe(40)},children:e.jsx(Y,{onChange:j,checked:i.length===n.length,indeterminate:i.length>0&&i.length!==n.length,transitionDuration:0})}),e.jsx("th",{children:e.jsx(u,{id:"HX5SVx"})}),e.jsx("th",{children:e.jsx(u,{id:"+zy2Nq"})}),e.jsx("th",{children:e.jsx(u,{id:"wdxz7K"})}),e.jsx("th",{children:e.jsx(u,{id:"PvB8gr"})})]})}),e.jsx("tbody",{children:h})]})})}function He({action:n}){const[i,o]=f.useState("");function a(){if(i==="")return;const h={id:G(),ref:i,data:{item:i},timestamp:new Date,source:"manually"};n([h]),o("")}function j(){const h={id:G(),ref:"Test item",data:{},timestamp:new Date,source:"manually"};n([h])}return e.jsxs(e.Fragment,{children:[e.jsxs(m,{children:[e.jsx(pe,{placeholder:c._({id:"mPrJo6"}),value:i,onChange:h=>o(h.currentTarget.value),onKeyDown:me([["Enter",a]])}),e.jsx(k,{onClick:a,w:16,children:e.jsx(ge,{})})]}),_e&&e.jsx(K,{onClick:j,variant:"outline",children:e.jsx(u,{id:"gUm1Y0"})})]})}function Re({action:n}){const[i,o]=f.useState(null),[a,j]=X({key:"camId",defaultValue:null}),[h,s]=f.useState([]),[r,S]=f.useState(null),[g,E]=f.useState(!1),[M,T]=f.useState(!1),_=be();let A="";f.useEffect(()=>{o(new Q("reader")),Q.getCameras().then(t=>{t!=null&&t.length&&s(t)})},[]),f.useEffect(()=>{a&&S(a.id)},[a]),f.useEffect(()=>{g&&_==="hidden"?(B(),T(!0)):M&&_==="visible"&&(R(),T(!1))},[_]);function I(t){if(i==null||i.pause(),t===A){i==null||i.resume();return}A=t,n([{id:G(),ref:t,data:t,timestamp:new Date,source:"imageBarcode"}]),i==null||i.resume()}function C(t){t!="QR code parse error, error = NotFoundException: No MultiFormat Readers were able to detect the code."&&console.warn(`Code scan error = ${t}`)}function H(){Q.getCameras().then(t=>{t!=null&&t.length&&j(t[0])}).catch(t=>{N({title:c._({id:"UHot+L"}),message:t,color:"red",icon:e.jsx(O,{})})})}function R(){a&&i&&!g&&(i.start(a.id,{fps:10,qrbox:{width:250,height:250}},t=>{I(t)},t=>{C(t)}).catch(t=>{N({title:c._({id:"bR26mb"}),message:t,color:"red",icon:e.jsx(O,{})})}),E(!0))}function B(){i&&g&&(i.stop().catch(t=>{N({title:c._({id:"fvJQqd"}),message:t,color:"red",icon:e.jsx(O,{})})}),E(!1))}return f.useEffect(()=>{if(r===null)return;if(r===(a==null?void 0:a.id)){console.log("matching value and id");return}const t=h.find(b=>b.id===r);i&&g?i.stop().then(()=>{j(t),i.start(t.id,{fps:10,qrbox:{width:250,height:250}},b=>{I(b)},b=>{C(b)})}):j(t)},[r]),e.jsxs(V,{spacing:"xs",children:[e.jsxs(m,{spacing:"xs",children:[e.jsx($,{value:r,onChange:S,data:h.map(t=>({value:t.id,label:t.label})),size:"sm"}),g?e.jsx(k,{onClick:B,title:c._({id:"yFRXH8"}),children:e.jsx(ke,{})}):e.jsx(k,{onClick:R,title:c._({id:"m3BKG+"}),disabled:!a,children:e.jsx(Se,{})}),e.jsx(Z,{sx:{flex:1}}),e.jsx(Ie,{color:g?"green":"orange",children:g?c._({id:"CMQ09J"}):c._({id:"Fg9r/3"})})]}),e.jsx(we,{px:0,id:"reader",w:"100%",mih:"300px"}),!a&&e.jsx(K,{onClick:H,children:e.jsx(u,{id:"QuNKRX"})})]})}export{Xe as default};
