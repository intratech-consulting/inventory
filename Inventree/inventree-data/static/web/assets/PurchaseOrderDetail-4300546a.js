import{r as p,i as t,j as a,h as C,d5 as P,a3 as F,b7 as v,ay as L,bt as w,b6 as R,bf as M,bg as U,bh as B,S as E,m as K}from"./vendor-580d7f6a.js";import{I as N,D as y}from"./ItemDetails-8f9834aa.js";import{D as O,N as G}from"./MarkdownEditor-8fcb1f1c.js";import{B as W,V as X,L as Q,U as V,A as z,E as H,D as Z}from"./ActionDropdown-0b7f88be.js";import{P as J}from"./PageDetail-e83b8dc6.js";import{P as Y}from"./PanelGroup-ecf19d17.js";import{a as S,A as o,U as m,i as T,M as j}from"./index-539d0685.js";import{u as I,p as $}from"./PurchaseOrderForms-075e7f87.js";import{a as ee,u as D,b as te}from"./UseForm-5e9a21d6.js";import{u as ae}from"./UseInstance-05463349.js";import{A as se}from"./AttachmentTable-3bae0b2b.js";import{u as ie,R as le,e as ne,a as re,A as oe,I as pe}from"./InvenTreeTable-7dffc519.js";import{A as ce}from"./AddItemButton-9bde5586.js";import{T as ue,d as de}from"./Instance-4f17d9b0.js";import{P as me}from"./ProgressBar-f667695e.js";import{g as _e}from"./urls-9eea01e5.js";import{R as be,e as he,i as xe,c as fe,T as ye,L as je}from"./ColumnRenderers-c7f5177c.js";import{u as ge,a as ke}from"./DesktopAppView-f36ad07f.js";import{S as Ae}from"./StockItemTable-b84d5ecc.js";import"./YesNoButton-cd4c504e.js";import"./ModelType-07300e1e.js";import"./BaseContext-71d55e61.js";import"./StylishText-5ee5b946.js";import"./notifications-b554622d.js";import"./Placeholder-f60056df.js";import"./ApiForm-173d0ec5.js";import"./StockForms-2847fb41.js";function ve({orderId:l,params:g}){const s=ie("purchase-order-line-item"),u=ge(),n=S(),_=p.useMemo(()=>[{accessor:"part",title:t._({id:"vgP+9p"}),sortable:!0,switchable:!1,render:e=>{var i,r,c;return a.jsx(ue,{text:(i=e==null?void 0:e.part_detail)==null?void 0:i.name,src:((r=e==null?void 0:e.part_detail)==null?void 0:r.thumbnail)??((c=e==null?void 0:e.part_detail)==null?void 0:c.image)})}},{accessor:"description",title:t._({id:"5ZWiLz"}),sortable:!1,render:e=>{var i;return(i=e==null?void 0:e.part_detail)==null?void 0:i.description}},be(),{accessor:"quantity",title:t._({id:"VbWX2u"}),sortable:!0,switchable:!1,render:e=>{let i=(e==null?void 0:e.supplier_part_detail)??{},r=(e==null?void 0:e.part_detail)??(i==null?void 0:i.part_detail)??{},c=[];if(i.pack_quantity_native!=1){let q=e.quantity*i.pack_quantity_native;c.push(a.jsxs(C,{children:[t._({id:"J9LTXQ"}),": ",i.pack_quantity]},"pack-quantity")),c.push(a.jsxs(C,{children:[t._({id:"GbI1d2"}),": ",q," ",r==null?void 0:r.units]},"total-quantity"))}return a.jsx(he,{value:e.quantity,extra:c,title:t._({id:"VbWX2u"})})}},{accessor:"received",title:t._({id:"fZ5Vnu"}),sortable:!1,render:e=>a.jsx(me,{progressLabel:!0,value:e.received,maximum:e.quantity})},{accessor:"pack_quantity",sortable:!1,title:t._({id:"J9LTXQ"}),render:e=>{var i;return(i=e==null?void 0:e.supplier_part_detail)==null?void 0:i.pack_quantity}},{accessor:"SKU",title:t._({id:"PeuqsI"}),switchable:!1,sortable:!0,render:e=>{var i;return(i=e==null?void 0:e.supplier_part_detail)==null?void 0:i.SKU}},{accessor:"supplier_link",title:t._({id:"h3/Rpt"}),sortable:!1,render:e=>{var i;return(i=e==null?void 0:e.supplier_part_detail)==null?void 0:i.link}},{accessor:"MPN",title:t._({id:"u7qly3"}),sortable:!0,render:e=>{var i,r;return(r=(i=e==null?void 0:e.supplier_part_detail)==null?void 0:i.manufacturer_part_detail)==null?void 0:r.MPN}},xe({accessor:"purchase_price",title:t._({id:"vWelsN"})}),fe(),ye(),{accessor:"destination",title:t._({id:"Enslfm"}),sortable:!1,render:e=>e.destination?de({instance:e.destination_detail}):"-"},{accessor:"notes",title:t._({id:"1DBGsz"})},je()],[l,n]),b=ee({url:o.purchase_order_line_list,title:t._({id:"pwb7Yo"}),fields:I({create:!0}),initialData:{order:l},onFormSuccess:s.refreshTable}),[h,x]=p.useState(void 0),d=D({url:o.purchase_order_line_list,pk:h,title:t._({id:"vgosWS"}),fields:I({}),onFormSuccess:s.refreshTable}),f=te({url:o.purchase_order_line_list,pk:h,title:t._({id:"tpKh8C"}),onFormSuccess:s.refreshTable}),k=p.useCallback(e=>[{hidden:((e==null?void 0:e.received)??0)>=((e==null?void 0:e.quantity)??0),title:t._({id:"ul9IpB"}),icon:a.jsx(P,{}),color:"green"},le({hidden:!n.hasChangeRole(m.purchase_order),onClick:()=>{x(e.pk),d.open()}}),ne({hidden:!n.hasAddRole(m.purchase_order)}),re({hidden:!n.hasDeleteRole(m.purchase_order),onClick:()=>{x(e.pk),f.open()}})],[l,n]),A=p.useMemo(()=>[a.jsx(ce,{tooltip:t._({id:"2vqtLo"}),onClick:()=>b.open(),hidden:!(n!=null&&n.hasAddRole(m.purchase_order))},"add-line-item"),a.jsx(oe,{text:t._({id:"gyK1dv"}),icon:a.jsx(P,{})},"receive-items")],[l,n]);return a.jsxs(a.Fragment,{children:[b.modal,d.modal,f.modal,a.jsx(pe,{url:T(o.purchase_order_line_list),tableState:s,columns:_,props:{enableSelection:!0,enableDownload:!0,params:{...g,order:l,part_detail:!0},rowActions:k,tableActions:A,onRowClick:e=>{e.part&&u(_e(j.supplierpart,e.part))}}})]})}function Ye(){var d;const{id:l}=ke(),g=S(),{instance:s,instanceQuery:u,refreshInstance:n}=ae({endpoint:o.purchase_order_list,pk:l,params:{supplier_detail:!0},refetchOnMount:!0}),_=D({url:o.purchase_order_list,pk:l,title:t._({id:"lAF9Uk"}),fields:$(),onFormSuccess:()=>{n()}}),b=p.useMemo(()=>{var i;if(u.isFetching)return a.jsx(F,{});let f=[{type:"text",name:"reference",label:t._({id:"N2C89m"}),copy:!0},{type:"text",name:"supplier_reference",label:t._({id:"K7PVg3"}),icon:"reference",hidden:!s.supplier_reference,copy:!0},{type:"link",name:"supplier",icon:"suppliers",label:t._({id:"PYTEl0"}),model:j.company},{type:"text",name:"description",label:t._({id:"Nu4oKW"}),copy:!0},{type:"status",name:"status",label:t._({id:"uAQUqI"}),model:j.purchaseorder}],k=[{type:"text",name:"line_items",label:t._({id:"SgduFH"}),icon:"list"},{type:"progressbar",name:"completed",icon:"progress",label:t._({id:"qgs95u"}),total:s.line_items,progress:s.completed_lines},{type:"progressbar",name:"shipments",icon:"shipment",label:t._({id:"polrQd"}),total:s.shipments,progress:s.completed_shipments},{type:"text",name:"currency",label:t._({id:"9j2hXW"})},{type:"text",name:"total_cost",label:t._({id:"A6C0pv"})}],A=[{type:"link",external:!0,name:"link",label:t._({id:"yzF66j"}),copy:!0,hidden:!s.link},{type:"link",model:j.contact,link:!1,name:"contact",label:t._({id:"jfC/xh"}),icon:"user",copy:!0}],e=[{type:"text",name:"creation_date",label:t._({id:"x9P/+F"}),icon:"calendar"},{type:"text",name:"target_date",label:t._({id:"ZmykKo"}),icon:"calendar",hidden:!s.target_date},{type:"text",name:"responsible",label:t._({id:"XQACoK"}),badge:"owner",hidden:!s.responsible}];return a.jsxs(N,{children:[a.jsxs(v,{children:[a.jsx(v.Col,{span:4,children:a.jsx(O,{appRole:m.purchase_order,apiPath:o.company_list,src:(i=s.supplier_detail)==null?void 0:i.image,pk:s.supplier})}),a.jsx(v.Col,{span:8,children:a.jsx(y,{fields:f,item:s})})]}),a.jsx(y,{fields:k,item:s}),a.jsx(y,{fields:A,item:s}),a.jsx(y,{fields:e,item:s})]})},[s,u]),h=p.useMemo(()=>[{name:"detail",label:t._({id:"Tol4BF"}),icon:a.jsx(L,{}),content:b},{name:"line-items",label:t._({id:"SgduFH"}),icon:a.jsx(w,{}),content:a.jsx(ve,{orderId:Number(l)})},{name:"received-stock",label:t._({id:"b447qM"}),icon:a.jsx(R,{}),content:a.jsx(Ae,{params:{purchase_order:l}})},{name:"attachments",label:t._({id:"w/Sphq"}),icon:a.jsx(M,{}),content:a.jsx(se,{endpoint:o.purchase_order_attachment_list,model:"order",pk:Number(l)})},{name:"notes",label:t._({id:"1DBGsz"}),icon:a.jsx(U,{}),content:a.jsx(G,{url:T(o.purchase_order_list,l),data:s.notes??"",allowEdit:!0})}],[s,l]),x=p.useMemo(()=>[a.jsx(W,{actions:[X({}),Q({disabled:s==null?void 0:s.barcode_hash}),V({disabled:!(s!=null&&s.barcode_hash)})]}),a.jsx(z,{tooltip:t._({id:"/IKytX"}),icon:a.jsx(B,{}),actions:[H({onClick:()=>{_.open()}}),Z({})]},"order-actions")],[l,s,g]);return a.jsxs(a.Fragment,{children:[_.modal,a.jsxs(E,{spacing:"xs",children:[a.jsx(K,{visible:u.isFetching}),a.jsx(J,{title:t._({id:"KxySMG"})+`: ${s.reference}`,subtitle:s.description,imageUrl:(d=s.supplier_detail)==null?void 0:d.image,breadcrumbs:[{name:t._({id:"UOTpFa"}),url:"/purchasing/"}],actions:x}),a.jsx(Y,{pageKey:"purchaseorder",panels:h})]})]})}export{Ye as default};
