import{x as j,aL as C,r as _,j as o,ac as k,G as h,b$ as v,i as t,S,m as T,h as n,a4 as w,cR as M}from"./vendor-580d7f6a.js";import{m as I}from"./index.es-6e6e8db2.js";import{g as P,i as x,A as b,a as D,M as f,U as F}from"./index-539d0685.js";import{S as R}from"./StylishText-5ee5b946.js";import{u as y}from"./DesktopAppView-f36ad07f.js";import{A as W}from"./AddItemButton-9bde5586.js";import{P as A,D as B,e as N,h as L,L as K}from"./ColumnRenderers-c7f5177c.js";import{u as G}from"./PartForms-dc889e22.js";import{g}from"./urls-9eea01e5.js";import{a as U}from"./UseForm-5e9a21d6.js";import{u as $,I as E}from"./InvenTreeTable-7dffc519.js";function se({opened:e,onClose:i,selectedCategory:l}){const m=y(),r=j({enabled:e,queryKey:["part_category_tree",e],queryFn:async()=>P.get(x(b.category_tree),{}).then(s=>s.data.map(p=>({id:p.pk,label:p.name,parentId:p.parent,children:p.subcategories}))).catch(s=>(console.error("Error fetching part category tree:",s),s)),refetchOnMount:!0});function c({node:s}){return o.jsx(h,{position:"apart",noWrap:!0,onClick:()=>{i(),m(`/part/category/${s.id}`)},children:o.jsx(n,{children:s.label})},s.id)}function d({node:s,open:p}){if(s.children!=0)return p?o.jsx(w,{}):o.jsx(M,{})}const a=C(),u=_.useMemo(()=>{const s=a.colorScheme==="dark"?a.colorScheme:a.primaryColor;return{dark:{text:{...a.fn.fontStyles()},nodes:{height:"2.5rem",folder:{selectedBgColor:a.colors[s][4],hoverBgColor:a.colors[s][6]},leaf:{selectedBgColor:a.colors[s][4],hoverBgColor:a.colors[s][6]},icons:{folderColor:a.colors[s][3],leafColor:a.colors[s][3]}}},light:{text:{...a.fn.fontStyles()},nodes:{height:"2.5rem",folder:{selectedBgColor:a.colors[s][4],hoverBgColor:a.colors[s][2]},leaf:{selectedBgColor:a.colors[s][4],hoverBgColor:a.colors[s][2]},icons:{folderColor:a.colors[s][8],leafColor:a.colors[s][6]}}}}},[a]);return o.jsx(k,{opened:e,size:"md",position:"left",onClose:i,withCloseButton:!0,styles:{header:{width:"100%"},title:{width:"100%"}},title:o.jsxs(h,{position:"left",p:"ms",spacing:"md",noWrap:!0,children:[o.jsx(v,{}),o.jsx(R,{size:"lg",children:t._({id:"2GkbLI"})})]}),children:o.jsxs(S,{spacing:"xs",children:[o.jsx(T,{visible:r.isFetching}),o.jsx(I,{nodes:r.data??[],RenderNode:c,RenderIcon:d,defaultSelectedNodes:l?[l]:[],showEmptyItems:!1,theme:a.colorScheme,themes:u})]})})}function O({str:e,len:i=100}){if(e=e??"",e=e.toString(),e.length<=i)return e;let l=Math.floor(i/2-1);return e.slice(0,l)+"..."+e.slice(-l)}function Q(){return[{accessor:"name",sortable:!0,noWrap:!0,render:e=>A(e)},{accessor:"IPN",sortable:!0},{accessor:"units",sortable:!0},B({}),{accessor:"category",sortable:!0,render:function(e){var i;return O({str:(i=e.category_detail)==null?void 0:i.pathstring})}},{accessor:"total_in_stock",sortable:!0,render:e=>{let i=[],l=(e==null?void 0:e.total_in_stock)??0,m=((e==null?void 0:e.allocated_to_build_orders)??0)+((e==null?void 0:e.allocated_to_sales_orders)??0),r=Math.max(0,l-m),c=(e==null?void 0:e.minimum_stock)??0,d=String(l),a;return c>l&&(i.push(o.jsx(n,{color:"orange",children:t._({id:"Lgnuy/"})+`: ${c}`},"min-stock")),a="orange"),e.ordering>0&&i.push(o.jsx(n,{children:t._({id:"0lg3zX"})+`: ${e.ordering}`},"on-order")),e.building&&i.push(o.jsx(n,{children:t._({id:"oZd08v"})+`: ${e.building}`},"building")),e.allocated_to_build_orders>0&&i.push(o.jsx(n,{children:t._({id:"KCpl4N"})+`: ${e.allocated_to_build_orders}`},"bo-allocations")),e.allocated_to_sales_orders>0&&i.push(o.jsx(n,{children:t._({id:"DaWMWw"})+`: ${e.allocated_to_sales_orders}`},"so-allocations")),r!=l&&i.push(o.jsxs(n,{children:[t._({id:"csDS2L"}),": ",r]},"available")),e.external_stock>0&&i.push(o.jsxs(n,{children:[t._({id:"e8fwfT"}),": ",e.external_stock]},"external")),l<=0?(a="red",d=t._({id:"AbC1Px"})):r<=0?a="orange":r<c&&(a="yellow"),o.jsx(N,{value:o.jsxs(h,{spacing:"xs",position:"left",noWrap:!0,children:[o.jsx(n,{color:a,children:d}),e.units&&o.jsxs(n,{size:"xs",color:a,children:["[",e.units,"]"]})]}),title:t._({id:"odasNw"}),extra:i})}},{accessor:"price_range",title:t._({id:"YA4hwj"}),sortable:!1,render:e=>L(e.pricing_min,e.pricing_max)},K()]}function q(){return[{name:"active",label:t._({id:"F6pfE9"}),description:t._({id:"PHri/6"}),type:"boolean"},{name:"assembly",label:t._({id:"WL36Yh"}),description:t._({id:"oQzKsK"}),type:"boolean"},{name:"cascade",label:t._({id:"NgZniC"}),description:t._({id:"5JhtGd"}),type:"boolean"},{name:"component",label:t._({id:"dK3Z9j"}),description:t._({id:"oO7QIX"}),type:"boolean"},{name:"trackable",label:t._({id:"y6MnU0"}),description:t._({id:"MbixSq"}),type:"boolean"},{name:"has_units",label:t._({id:"YyRdJQ"}),description:t._({id:"WyFVby"}),type:"boolean"},{name:"has_ipn",label:t._({id:"c9/Fqb"}),description:t._({id:"jh/Aa+"}),type:"boolean"},{name:"has_stock",label:t._({id:"JqmfuT"}),description:t._({id:"6Kd+HK"}),type:"boolean"},{name:"low_stock",label:t._({id:"UgdO7s"}),description:t._({id:"GDYPCw"}),type:"boolean"},{name:"purchaseable",label:t._({id:"TW9g28"}),description:t._({id:"KMdl2R"}),type:"boolean"},{name:"salable",label:t._({id:"/3xNJ4"}),description:t._({id:"V5i7hf"}),type:"boolean"},{name:"virtual",label:t._({id:"ksX7Wx"}),description:t._({id:"QDTpY6"}),type:"choice",choices:[{value:"true",label:t._({id:"ksX7Wx"})},{value:"false",label:t._({id:"+SkaI8"})}]}]}function ie({props:e}){const i=_.useMemo(()=>Q(),[]),l=_.useMemo(()=>q(),[]),m=$("part-list"),r=y(),c=D(),d=U({url:b.part_list,title:t._({id:"rGfVOS"}),fields:G({create:!0}),initialData:{...e.params??{}},onFormSuccess:u=>{u.pk&&r(g(f.part,u.pk))}}),a=_.useMemo(()=>[o.jsx(W,{hidden:!c.hasAddRole(F.part),tooltip:t._({id:"rGfVOS"}),onClick:()=>d.open()})],[c]);return o.jsxs(o.Fragment,{children:[d.modal,o.jsx(E,{url:x(b.part_list),tableState:m,columns:i,props:{...e,enableDownload:!0,tableFilters:l,tableActions:a,params:{...e.params,category_detail:!0},onRowClick:u=>r(g(f.part,u.pk))}})]})}export{ie as P,se as a};
