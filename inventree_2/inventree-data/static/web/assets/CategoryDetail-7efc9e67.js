import{x as A,r as n,j as t,i as a,a3 as D,h,ay as S,cP as v,b$ as w,cQ as K,S as N,m as Z}from"./vendor-580d7f6a.js";import{I as B,D as j}from"./ItemDetails-8f9834aa.js";import{P as E}from"./PageDetail-e83b8dc6.js";import{P as L}from"./PanelGroup-ecf19d17.js";import{P as O,a as Q}from"./PartTable-893897df.js";import{a as k,i as y,A as b,M as f,g as U,U as C}from"./index-539d0685.js";import{u as $}from"./UseInstance-05463349.js";import{g as x}from"./urls-9eea01e5.js";import{u as I,I as T,R as W}from"./InvenTreeTable-7dffc519.js";import{e as Y,P as q,D as M}from"./ColumnRenderers-c7f5177c.js";import{u as F,a as G}from"./DesktopAppView-f36ad07f.js";import{A as H}from"./AddItemButton-9bde5586.js";import{Y as X}from"./YesNoButton-cd4c504e.js";import{p as P}from"./PartForms-dc889e22.js";import{a as J,u as z}from"./UseForm-5e9a21d6.js";import"./ProgressBar-f667695e.js";import"./ModelType-07300e1e.js";import"./Instance-4f17d9b0.js";import"./StylishText-5ee5b946.js";import"./Placeholder-f60056df.js";import"./BaseContext-71d55e61.js";import"./index.es-6e6e8db2.js";import"./notifications-b554622d.js";import"./ApiForm-173d0ec5.js";function V({categoryId:p}){const r=I("parametric-parts");k();const u=F(),c=A({queryKey:["category-parameters",p],queryFn:async()=>U.get(y(b.part_parameter_template_list),{params:{category:p}}).then(s=>s.data).catch(s=>[]),refetchOnMount:!0}),e=n.useMemo(()=>(c.data??[]).map(i=>({accessor:`parameter_${i.pk}`,title:i.name,sortable:!0,render:g=>{var d;let l=(d=g.parameters)==null?void 0:d.find(o=>o.template==i.pk);if(!l)return"-";let m=[];return i.units&&l.data_numeric&&l.data_numeric!=l.data&&m.push(`${l.data_numeric} [${i.units}]`),t.jsx(Y,{value:l.data,extra:m,title:a._({id:"Y0ne3N"})})}})),[c.data]),_=n.useMemo(()=>[...[{accessor:"name",sortable:!0,switchable:!1,noWrap:!0,render:i=>q(i)},M({}),{accessor:"IPN",sortable:!0}],...e],[e]);return t.jsx(T,{url:y(b.part_list),tableState:r,columns:_,props:{enableDownload:!1,params:{category:p,cascade:!0,category_detail:!0,parameters:!0},onRowClick:s=>{s.pk&&u(x(f.part,s.pk))}}})}function ee({parentId:p}){const r=F(),u=I("partcategory"),c=k(),e=n.useMemo(()=>[{accessor:"name",sortable:!0,switchable:!1},M({}),{accessor:"pathstring",sortable:!1},{accessor:"structural",sortable:!0,render:o=>t.jsx(X,{value:o.structural})},{accessor:"part_count",sortable:!0}],[]),_=n.useMemo(()=>[{name:"cascade",label:a._({id:"NgZniC"}),description:a._({id:"Tt3/Pp"})},{name:"structural",label:a._({id:"PRKZBP"}),description:a._({id:"kHkg2b"})}],[]),s=J({url:b.category_list,title:a._({id:"sIMwJx"}),fields:P({}),initialData:{parent:p},onFormSuccess(o){o.pk?r(x(f.partcategory,o.pk)):u.refreshTable()}}),[i,g]=n.useState(-1),l=z({url:b.category_list,pk:i,title:a._({id:"7fjpj0"}),fields:P({}),onFormSuccess:u.refreshTable}),m=n.useMemo(()=>{let o=c.hasAddRole(C.part_category);return[t.jsx(H,{tooltip:a._({id:"5LuNgu"}),onClick:()=>s.open(),disabled:!o})]},[c]),d=n.useCallback(o=>{let R=c.hasChangeRole(C.part_category);return[W({hidden:!R,onClick:()=>{g(o.pk),l.open()}})]},[c]);return t.jsxs(t.Fragment,{children:[s.modal,l.modal,t.jsx(T,{url:y(b.category_list),tableState:u,columns:e,props:{enableDownload:!0,params:{parent:p},tableFilters:_,tableActions:m,rowActions:d,onRowClick:o=>r(x(f.partcategory,o.pk))}})]})}function Ie({}){const{id:p}=G(),r=n.useMemo(()=>isNaN(parseInt(p||""))?void 0:p,[p]),[u,c]=n.useState(!1),{instance:e,refreshInstance:_,instanceQuery:s}=$({endpoint:b.category_list,hasPrimaryKey:!0,pk:r,params:{path_detail:!0}}),i=n.useMemo(()=>{if(r&&s.isFetching)return t.jsx(D,{});let m=[{type:"text",name:"name",label:a._({id:"6YtxFj"}),copy:!0},{type:"text",name:"pathstring",label:a._({id:"I6gXOa"}),icon:"sitemap",copy:!0,hidden:!r},{type:"text",name:"description",label:a._({id:"Nu4oKW"}),copy:!0},{type:"link",name:"parent",model_field:"name",icon:"location",label:a._({id:"o8hZ41"}),model:f.partcategory,hidden:!(e!=null&&e.parent)}],d=[{type:"text",name:"part_count",label:a._({id:"pmRbKZ"}),icon:"part"},{type:"text",name:"subcategories",label:a._({id:"7lonqg"}),icon:"sitemap",hidden:!(e!=null&&e.subcategories)},{type:"boolean",name:"structural",label:a._({id:"PRKZBP"}),icon:"sitemap"}];return t.jsxs(B,{children:[r&&(e!=null&&e.pk)?t.jsx(j,{item:e,fields:m}):t.jsx(h,{children:a._({id:"PFKWrQ"})}),r&&(e==null?void 0:e.pk)&&t.jsx(j,{item:e,fields:d})]})},[e,s]),g=n.useMemo(()=>[{name:"details",label:a._({id:"wp9B4i"}),icon:t.jsx(S,{}),content:i},{name:"parts",label:a._({id:"pmRbKZ"}),icon:t.jsx(v,{}),content:t.jsx(O,{props:{params:{category:r}}})},{name:"subcategories",label:a._({id:"2GkbLI"}),icon:t.jsx(w,{}),content:t.jsx(ee,{parentId:r})},{name:"parameters",label:a._({id:"F18WP3"}),icon:t.jsx(K,{}),content:t.jsx(V,{categoryId:r})}],[e,r]),l=n.useMemo(()=>[{name:a._({id:"pmRbKZ"}),url:"/part"},...(e.path??[]).map(m=>({name:m.name,url:`/part/category/${m.pk}`}))],[e]);return t.jsxs(N,{spacing:"xs",children:[t.jsx(Z,{visible:s.isFetching}),t.jsx(Q,{opened:u,onClose:()=>{c(!1)},selectedCategory:e==null?void 0:e.pk}),t.jsx(E,{title:a._({id:"QXANxH"}),detail:t.jsx(h,{children:e.name??"Top level"}),breadcrumbs:l,breadcrumbAction:()=>{c(!0)}}),t.jsx(L,{pageKey:"partcategory",panels:g})]})}export{Ie as default};
