import{r as d,i as a,j as e,h as n,G as v,cV as S,ba as U,bl as z,a3 as _,b7 as k,ay as G,d3 as w,bU as E,d4 as F,bt as N,b$ as O,bf as R,bg as K,a0 as Q,cL as V,ct as H,bh as X,S as Z,m as Y}from"./vendor-580d7f6a.js";import{I as J,D as x}from"./ItemDetails-8f9834aa.js";import{D as $,N as W}from"./MarkdownEditor-8fcb1f1c.js";import{A as g,V as ee,L as te,U as ae,E as ie,a as se}from"./ActionDropdown-0b7f88be.js";import{P as le}from"./PageDetail-e83b8dc6.js";import{P as ne}from"./PanelGroup-ecf19d17.js";import{P as oe,S as re}from"./Instance-4f17d9b0.js";import{a as P,i as T,A as c,M as r,U as C}from"./index-539d0685.js";import{B as de,b as me}from"./BuildOrderTable-0f548787.js";import{u as ce}from"./UseForm-5e9a21d6.js";import{u as pe}from"./UseInstance-05463349.js";import{P as ue}from"./ProgressBar-f667695e.js";import{g as be}from"./urls-9eea01e5.js";import{u as _e,I as xe}from"./InvenTreeTable-7dffc519.js";import{e as je,B as A}from"./ColumnRenderers-c7f5177c.js";import{u as he,a as fe}from"./DesktopAppView-f36ad07f.js";import{A as ke}from"./AttachmentTable-3bae0b2b.js";import{S as L}from"./StockItemTable-b84d5ecc.js";import"./YesNoButton-cd4c504e.js";import"./ModelType-07300e1e.js";import"./BaseContext-71d55e61.js";import"./StylishText-5ee5b946.js";import"./notifications-b554622d.js";import"./Placeholder-f60056df.js";import"./AddItemButton-9bde5586.js";import"./ApiForm-173d0ec5.js";import"./StockForms-2847fb41.js";function ge({params:o={}}){const u=_e("buildline"),i=P(),j=he(),p=d.useMemo(()=>[{name:"allocated",description:a._({id:"qhfAiQ"})},{name:"available",label:a._({id:"csDS2L"}),description:a._({id:"INp5cq"})},{name:"consumable",label:a._({id:"duCsZf"}),description:a._({id:"4xoOP+"})},{name:"optional",label:a._({id:"LLAa/9"}),description:a._({id:"JZ0XU+"})}],[]),h=d.useCallback(t=>{let s=(t==null?void 0:t.bom_item_detail)??{},l=[],m=t==null?void 0:t.available_stock;return t.available_substitute_stock>0&&(m+=t.available_substitute_stock,l.push(e.jsx(n,{size:"sm",children:a._({id:"XTe+lK"})},"substitite"))),s.allow_variants&&t.available_variant_stock>0&&(m+=t.available_variant_stock,l.push(e.jsx(n,{size:"sm",children:a._({id:"LdvJ9e"})},"variant"))),t.in_production>0&&l.push(e.jsxs(n,{size:"sm",children:[a._({id:"G1xXyB"}),": ",t.in_production]},"production")),t.on_order>0&&l.push(e.jsxs(n,{size:"sm",children:[a._({id:"/MB+gl"}),": ",t.on_order]},"on-order")),t.external_stock>0&&l.push(e.jsxs(n,{size:"sm",children:[a._({id:"e8fwfT"}),": ",t.external_stock]},"external")),e.jsx(je,{value:m>0?m:e.jsx(n,{color:"red",italic:!0,children:a._({id:"a5n/wL"})}),title:a._({id:"oGd3rK"}),extra:l})},[]),f=d.useMemo(()=>[{accessor:"bom_item",sortable:!0,switchable:!1,render:t=>e.jsx(oe,{part:t.part_detail})},{accessor:"bom_item_detail.reference"},A({accessor:"bom_item_detail.consumable"}),A({accessor:"bom_item_detail.optional"}),{accessor:"bom_item_detail.quantity",sortable:!0,title:a._({id:"O7oMsT"}),ordering:"unit_quantity",render:t=>{var s,l;return e.jsxs(v,{position:"apart",children:[e.jsx(n,{children:(s=t.bom_item_detail)==null?void 0:s.quantity}),((l=t==null?void 0:t.part_detail)==null?void 0:l.units)&&e.jsxs(n,{size:"xs",children:["[",t.part_detail.units,"]"]})]})}},{accessor:"quantity",sortable:!0,render:t=>{var s;return e.jsxs(v,{position:"apart",children:[e.jsx(n,{children:t.quantity}),((s=t==null?void 0:t.part_detail)==null?void 0:s.units)&&e.jsxs(n,{size:"xs",children:["[",t.part_detail.units,"]"]})]})}},{accessor:"available_stock",sortable:!0,switchable:!1,render:h},{accessor:"allocated",switchable:!1,render:t=>{var s;return(s=t==null?void 0:t.bom_item_detail)!=null&&s.consumable?e.jsx(n,{italic:!0,children:a._({id:"f/GbFw"})}):e.jsx(ue,{progressLabel:!0,value:t.allocated,maximum:t.quantity})}}],[]),b=d.useCallback(t=>{var l;let s=t.part_detail;return(l=t==null?void 0:t.bom_item_detail)!=null&&l.consumable?[]:[{icon:e.jsx(S,{}),title:a._({id:"L1LMmH"}),hidden:t.allocated>=t.quantity,color:"green"},{icon:e.jsx(U,{}),title:a._({id:"cUzrZK"}),hidden:!(s!=null&&s.purchaseable),color:"blue"},{icon:e.jsx(z,{}),title:a._({id:"vgTd7I"}),hidden:!(s!=null&&s.assembly),color:"blue"}]},[i]);return e.jsx(xe,{url:T(c.build_line_list),tableState:u,columns:f,props:{params:{...o,part_detail:!0},tableFilters:p,rowActions:b,onRowClick:t=>{var s;(s=t==null?void 0:t.part_detail)!=null&&s.pk&&j(be(r.part,t.part_detail.pk))}}})}function Ze(){var l,m;const{id:o}=fe(),u=P(),{instance:i,refreshInstance:j,instanceQuery:p}=pe({endpoint:c.build_order_list,pk:o,params:{part_detail:!0},refetchOnMount:!0}),h=d.useMemo(()=>{var y,I;if(p.isFetching)return e.jsx(_,{});let B=[{type:"link",name:"part",label:a._({id:"vgP+9p"}),model:r.part},{type:"status",name:"status",label:a._({id:"uAQUqI"}),model:r.build},{type:"text",name:"reference",label:a._({id:"N2C89m"})},{type:"text",name:"title",label:a._({id:"Nu4oKW"}),icon:"description"},{type:"link",name:"parent",icon:"builds",label:a._({id:"jqsG41"}),model_field:"reference",model:r.build,hidden:!i.parent}],q=[{type:"text",name:"quantity",label:a._({id:"Ee+3kG"})},{type:"progressbar",name:"completed",icon:"progress",total:i.quantity,progress:i.completed,label:a._({id:"Mzv4va"})},{type:"link",name:"sales_order",label:a._({id:"LozYBo"}),icon:"sales_orders",model:r.salesorder,model_field:"reference",hidden:!i.sales_order}],D=[{type:"text",name:"issued_by",label:a._({id:"kmUN8p"}),badge:"user"},{type:"text",name:"responsible",label:a._({id:"XQACoK"}),badge:"owner",hidden:!i.responsible}],M=[{type:"link",name:"take_from",icon:"location",model:r.stocklocation,label:a._({id:"/00Ond"}),backup_value:a._({id:"aZD9Yv"})},{type:"link",name:"destination",icon:"location",model:r.stocklocation,label:a._({id:"o35LCI"}),hidden:!i.destination}];return e.jsxs(J,{children:[e.jsxs(k,{children:[e.jsx(k.Col,{span:4,children:e.jsx($,{appRole:C.part,apiPath:c.part_list,src:((y=i.part_detail)==null?void 0:y.image)??((I=i.part_detail)==null?void 0:I.thumbnail),pk:i.part})}),e.jsx(k.Col,{span:8,children:e.jsx(x,{fields:B,item:i})})]}),e.jsx(x,{fields:q,item:i}),e.jsx(x,{fields:D,item:i}),e.jsx(x,{fields:M,item:i})]})},[i,p]),f=d.useMemo(()=>[{name:"details",label:a._({id:"98Q4bz"}),icon:e.jsx(G,{}),content:h},{name:"allocate-stock",label:a._({id:"L1LMmH"}),icon:e.jsx(w,{}),content:i!=null&&i.pk?e.jsx(ge,{params:{build:o,tracked:!1}}):e.jsx(_,{})},{name:"incomplete-outputs",label:a._({id:"E9en8O"}),icon:e.jsx(E,{})},{name:"complete-outputs",label:a._({id:"Mzv4va"}),icon:e.jsx(F,{}),content:e.jsx(L,{params:{build:o,is_building:!1}})},{name:"consumed-stock",label:a._({id:"US3GCq"}),icon:e.jsx(N,{}),content:e.jsx(L,{params:{consumed_by:o}})},{name:"child-orders",label:a._({id:"CVlgqS"}),icon:e.jsx(O,{}),content:i.pk?e.jsx(de,{parentBuildId:i.pk}):e.jsx(_,{})},{name:"attachments",label:a._({id:"w/Sphq"}),icon:e.jsx(R,{}),content:e.jsx(ke,{endpoint:c.build_order_attachment_list,model:"build",pk:Number(o)})},{name:"notes",label:a._({id:"1DBGsz"}),icon:e.jsx(K,{}),content:e.jsx(W,{url:T(c.build_order_list,i.pk),data:i.notes??"",allowEdit:!0})}],[i,o]),b=ce({url:c.build_order_list,pk:i.pk,title:a._({id:"B7ynKf"}),fields:me(),onFormSuccess:()=>{j()}}),t=d.useMemo(()=>[e.jsx(g,{tooltip:a._({id:"heU0Hk"}),icon:e.jsx(Q,{}),actions:[ee({}),te({disabled:i==null?void 0:i.barcode_hash}),ae({disabled:!(i!=null&&i.barcode_hash)})]},"barcode"),e.jsx(g,{tooltip:a._({id:"Tyj32s"}),icon:e.jsx(V,{}),actions:[{icon:e.jsx(H,{}),name:a._({id:"gjpdaf"}),tooltip:a._({id:"V7w5fl"})}]},"report"),e.jsx(g,{tooltip:a._({id:"tDgG1Y"}),icon:e.jsx(X,{}),actions:[ie({onClick:()=>b.open(),disabled:!u.hasChangeRole(C.build)}),se({})]},"build")],[o,i,u]),s=d.useMemo(()=>i!=null&&i.status?re({status:i.status,type:r.build}):e.jsx(_,{}),[i,o]);return e.jsxs(e.Fragment,{children:[b.modal,e.jsxs(Z,{spacing:"xs",children:[e.jsx(Y,{visible:p.isFetching}),e.jsx(le,{title:i.reference,subtitle:i.title,detail:s,imageUrl:((l=i.part_detail)==null?void 0:l.image)??((m=i.part_detail)==null?void 0:m.thumbnail),breadcrumbs:[{name:a._({id:"RCVhIP"}),url:"/build"},{name:i.reference,url:`/build/${i.pk}`}],actions:t}),e.jsx(ne,{pageKey:"build",panels:f})]})]})}export{Ze as default};
